<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Chess DB Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #eee;
      margin: 0;
      padding: 0;
      direction: rtl;
    }
    header {
      background: #222;
      padding: 1rem;
      text-align: center;
      border-bottom: 1px solid #333;
    }
    main {
      padding: 1rem;
      max-width: 1000px;
      margin: 0 auto;
    }
    .card {
      background: #1b1b1b;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      border: 1px solid #333;
    }
    h2 {
      margin-top: 0;
      font-size: 1.1rem;
    }
    pre {
      background: #000;
      padding: 0.5rem;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 0.8rem;
    }
    select, button {
      padding: 0.4rem 0.6rem;
      border-radius: 4px;
      border: 1px solid #444;
      background: #222;
      color: #eee;
    }
    button {
      cursor: pointer;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .badge {
      display: inline-block;
      padding: 0.1rem 0.4rem;
      border-radius: 999px;
      background: #333;
      font-size: 0.75rem;
      margin-left: 0.3rem;
    }
    a {
      color: #4da3ff;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ“Š Chess DB (GitHub JSON)</h1>
    <p>Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© ÙÙŠ Ù…Ù„Ù <code>db.json</code></p>
  </header>
  <main>
    <div class="card">
      <div class="row">
        <label for="chatSelect">Ø§Ø®ØªØ± chat_id:</label>
        <select id="chatSelect"></select>
        <button id="refreshBtn">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
      </div>
      <p id="status">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
    </div>

    <div class="card">
      <h2>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>
      <div id="userInfo"></div>
    </div>

    <div class="card">
      <h2>â™Ÿï¸ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</h2>
      <div id="gamesInfo"></div>
    </div>

    <div class="card">
      <h2>âœ¨ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Brilliant</h2>
      <div id="brilliantInfo"></div>
    </div>
  </main>

  <script>
    // Ø¹Ø¯Ù„ Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· raw Ù„Ù„Ù…Ù„Ù db.json ÙÙŠ Ù…Ø³ØªÙˆØ¯Ø¹Ùƒ
    // Ù…Ø«Ø§Ù„:
    // https://raw.githubusercontent.com/USERNAME/chess-db/main/db.json
    const DB_URL = "https://raw.githubusercontent.com/USERNAME/REPO/main/db.json";

    const chatSelect = document.getElementById('chatSelect');
    const statusEl = document.getElementById('status');
    const userInfo = document.getElementById('userInfo');
    const gamesInfo = document.getElementById('gamesInfo');
    const brilliantInfo = document.getElementById('brilliantInfo');
    const refreshBtn = document.getElementById('refreshBtn');

    async function loadDB() {
      statusEl.textContent = "Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
      userInfo.innerHTML = "";
      gamesInfo.innerHTML = "";
      brilliantInfo.innerHTML = "";
      chatSelect.innerHTML = "";

      try {
        const res = await fetch(DB_URL + "?_=" + Date.now());
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }
        const db = await res.json();

        const chatIds = new Set([
          ...Object.keys(db.users || {}),
          ...Object.keys(db.games || {}),
          ...Object.keys(db.brilliant_games || {})
        ]);

        if (chatIds.size === 0) {
          statusEl.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ ÙÙŠ db.json";
          return;
        }

        for (const id of chatIds) {
          const opt = document.createElement('option');
          opt.value = id;
          opt.textContent = id;
          chatSelect.appendChild(opt);
        }

        statusEl.textContent = "ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ âœ…";
        showChat(db, chatSelect.value);

        chatSelect.onchange = () => showChat(db, chatSelect.value);

      } catch (err) {
        console.error(err);
        statusEl.textContent = "Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© db.json: " + err.message;
      }
    }

    function showChat(db, chatId) {
      const user = (db.users || {})[chatId];
      const games = (db.games || {})[chatId] || { all: [], done: [] };
      const brilliants = (db.brilliant_games || {})[chatId] || [];

      // user
      userInfo.innerHTML = "";
      if (!user) {
        userInfo.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù‡Ø°Ø§ chat_id.";
      } else {
        const div = document.createElement('div');
        const username = user.username || "(ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯)";
        div.innerHTML = `
          <p>ğŸ‘¤ <strong>username:</strong> <code>${username}</code></p>
          <p>ğŸª <strong>Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙˆÙƒÙŠØ²:</strong> ${Array.isArray(user.cookies) ? user.cookies.length : 0}</p>
          <details>
            <summary>Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆÙƒÙŠØ² (JSON)</summary>
            <pre>${JSON.stringify(user.cookies, null, 2)}</pre>
          </details>
        `;
        userInfo.appendChild(div);
      }

      // games
      gamesInfo.innerHTML = "";
      const gDiv = document.createElement('div');
      const allCount = (games.all || []).length;
      const doneCount = (games.done || []).length;
      gDiv.innerHTML = `
        <p>
          <span class="badge">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª: ${allCount}</span>
          <span class="badge">ØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡Ø§: ${doneCount}</span>
        </p>
        <details>
          <summary>Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Game IDs</summary>
          <pre>${JSON.stringify(games.all || [], null, 2)}</pre>
        </details>
        <details>
          <summary>Ø¹Ø±Ø¶ Game IDs Ø§Ù„ØªÙŠ ØªÙ… ØªØ­Ù„ÙŠÙ„Ù‡Ø§</summary>
          <pre>${JSON.stringify(games.done || [], null, 2)}</pre>
        </details>
      `;
      gamesInfo.appendChild(gDiv);

      // brilliant games
      brilliantInfo.innerHTML = "";
      if (!brilliants.length) {
        brilliantInfo.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª Brilliant Ù…Ø³Ø¬Ù„Ø©.";
      } else {
        const ul = document.createElement('ul');
        brilliants.forEach(link => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = link;
          a.target = "_blank";
          a.textContent = link;
          li.appendChild(a);
          ul.appendChild(li);
        });
        brilliantInfo.appendChild(ul);
      }
    }

    refreshBtn.addEventListener('click', loadDB);

    loadDB();
  </script>
</body>
</html>
